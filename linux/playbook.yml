- name: Computer setup
  hosts: localhost
  tasks:
    - name: Check for rpm-ostree
      ansible.builtin.stat:
        path: /usr/bin/rpm-ostree
      register: rpm_ostree_stat

    - name: Set rpm-ostree fact
      ansible.builtin.set_fact:
        is_fedora: "{{ ansible_facts['distribution'] == 'Fedora' }}"
        is_ubuntu: "{{ ansible_facts['distribution'] == 'Ubuntu' }}"
        has_rpm_ostree: "{{ rpm_ostree_stat.stat.exists }}"

    - name: Debug
      ansible.builtin.debug:
        msg: "ansible_run_tags: {{ ansible_run_tags }}; ansible_skip_tags: {{ ansible_skip_tags }}"

    - import_tasks: tasks/packages.yml
    - import_tasks: tasks/bin/fd.yml
    - import_tasks: tasks/bin/fnm.yml
    - import_tasks: tasks/bin/fzf.yml
    - import_tasks: tasks/bin/ripgrep.yml
    - import_tasks: tasks/bin/bat.yml
    - import_tasks: tasks/bin/eza.yml
    - import_tasks: tasks/bin/nvim.yml
    - import_tasks: tasks/bin/yazi.yml
    - import_tasks: tasks/bin/jq.yml
    - import_tasks: tasks/bin/yq.yml
    - import_tasks: tasks/bin/starship.yml
    - include_tasks: tasks/dotnet.yml
      loop:
        - { version: "6.0", tag: "dotnet6" }
        - { version: "7.0", tag: "dotnet7" }
        - { version: "8.0", tag: "dotnet8" }
        - { version: "9.0", tag: "dotnet9" }
      when: |
        (item.tag in ansible_run_tags and (item.tag not in ansible_skip_tags and 'dotnet' not in ansible_skip_tags))
        or ('dotnet' in ansible_run_tags and (item.tag not in ansible_skip_tags and 'dotnet' not in ansible_skip_tags))
        or ('all' in ansible_run_tags and (item.tag not in ansible_skip_tags and 'dotnet' not in ansible_skip_tags))
    - import_tasks: tasks/dotfiles.yml
    - import_tasks: tasks/wsl.yaml
  tags: always
