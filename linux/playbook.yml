- name: Computer setup
  hosts: localhost
  tasks:
    - name: Check for rpm-ostree
      ansible.builtin.stat:
        path: /usr/bin/rpm-ostree
      register: rpm_ostree_stat
      tags: always

    - name: Set rpm-ostree fact
      ansible.builtin.set_fact:
        is_fedora: "{{ ansible_facts['distribution'] == 'Fedora' and not rpm_ostree_stat.stat.exists }}"
        is_fedora_silverblue: "{{ ansible_facts['distribution'] == 'Fedora' and rpm_ostree_stat.stat.exists }}"
        is_ubuntu: "{{ ansible_facts['distribution'] == 'Ubuntu' }}"
      tags: always

    - import_tasks: tasks/packages.yml
      tags: packages

    - name: Bin setup directories
      tags: 
        - bin
        - fd
        - deno
        - uv
        - poetry
        - fnm
        - fzf
        - ripgrep
        - bat
        - eza
        - zellij
        - nvim
        - yazi
        - jq
        - yq
        - starship
        - imagemagick
        - tmux
        - zed
        - lazygit
        - azure-cli
        - tree-sitter-cli
        - jetbrains-mono-nerd-font
        - nerd-fonts-symbols-only
        - sqlplus
        - postgresql
        - openjdk
        - sqlcl
      block:
        - name: Create local bin
          ansible.builtin.file:
            path: "{{ ansible_env.HOME }}/.local/bin"
            state: directory
        - name: Create local opt
          ansible.builtin.file:
            path: "{{ ansible_env.HOME }}/.local/opt"
            state: directory

    - import_tasks: tasks/bin/fd.yml
      tags: [bin, fd]
    - import_tasks: tasks/bin/deno.yml
      tags: [bin, deno]
    - import_tasks: tasks/bin/uv.yml
      tags: [bin, uv]
    - import_tasks: tasks/bin/poetry.yml
      tags: [bin, poetry]
    - import_tasks: tasks/bin/fnm.yml
      tags: [bin, fnm]
    - import_tasks: tasks/bin/fzf.yml
      tags: [bin, fzf]
    - import_tasks: tasks/bin/ripgrep.yml
      tags: [bin, ripgrep]
    - import_tasks: tasks/bin/bat.yml
      tags: [bin, bat]
    - import_tasks: tasks/bin/eza.yml
      tags: [bin, eza]
    - import_tasks: tasks/bin/zellij.yml
      tags: [bin, zellij]
    - import_tasks: tasks/bin/nvim.yml
      tags: [bin, nvim]
    - import_tasks: tasks/bin/yazi.yml
      tags: [bin, yazi]
    - import_tasks: tasks/bin/jq.yml
      tags: [bin, jq]
    - import_tasks: tasks/bin/yq.yml
      tags: [bin, yq]
    - import_tasks: tasks/bin/starship.yml
      tags: [bin, starship]
    - import_tasks: tasks/bin/imagemagick.yml
      tags: [bin, imagemagick]
    - import_tasks: tasks/bin/tmux.yml
      tags: [bin, tmux]
    - import_tasks: tasks/bin/zed.yml
      tags: [bin, zed]
    - import_tasks: tasks/bin/lazygit.yml
      tags: [bin, lazygit]
    - import_tasks: tasks/bin/azure-cli.yml
      tags: [bin, azure-cli]
    - import_tasks: tasks/bin/tree-sitter-cli.yml
      tags: [bin, tree-sitter-cli]
    - import_tasks: tasks/bin/jetbrains-mono-nerd-font.yml
      tags: [bin, jetbrains-mono-nerd-font, fonts]
    - import_tasks: tasks/bin/nerd-fonts-symbols-only.yml
      tags: [bin, nerd-fonts-symbols-only, fonts]
    - import_tasks: tasks/bin/sqlplus.yml
      tags: [bin, sqlplus]
    - import_tasks: tasks/bin/postgresql.yml
      tags: [bin, postgresql]
    - import_tasks: tasks/bin/openjdk.yml
      tags: [bin, openjdk]
    - import_tasks: tasks/bin/sqlcl.yml
      tags: [bin, sqlcl]

    - name: Dotnet
      tags: dotnet
      block:
        - import_tasks: tasks/dotnet.yml
          vars:
            dotnet_version: 6.0
          tags: dotnet6
        - import_tasks: tasks/dotnet.yml
          vars:
            dotnet_version: 7.0
          tags: dotnet7
        - import_tasks: tasks/dotnet.yml
          vars:
            dotnet_version: 8.0
          tags: dotnet8
        - import_tasks: tasks/dotnet.yml
          vars:
            dotnet_version: 9.0
          tags: dotnet9
        - import_tasks: tasks/dotnet.yml
          vars:
            dotnet_version: 10.0
          tags: dotnet10

    - import_tasks: tasks/dotfiles.yml
      tags: dotfiles

    - import_tasks: tasks/wsl.yml
      tags: wsl
