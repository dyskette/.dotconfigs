// Amazing keys
//
// Zed keymap
//
// For information on binding keys, see the Zed
// documentation: https://zed.dev/docs/key-bindings
//
// To see the default key bindings run `zed: open default keymap`
// from the command palette.
//
// Custom vim-style keybindings for Zed editor

[
    // ============================================================================
    // WORKSPACE & PANES
    // ============================================================================
    {
        "context": "Workspace",
        "bindings": {
            // Pane navigation
            "ctrl-w h": "workspace::ActivatePaneLeft",
            "ctrl-w l": "workspace::ActivatePaneRight",
            "ctrl-w j": "workspace::ActivatePaneUp",
            "ctrl-w k": "workspace::ActivatePaneDown"
        }
    },

    // ============================================================================
    // FILE NAVIGATION & SEARCH
    // ============================================================================
    {
        "context": "vim_mode == normal || vim_mode == visual || vim_mode == operator || VimControl && !menuVimControl && !menu",
        "bindings": {
            // File search (matching fzf keymaps)
            "space s f": "file_finder::Toggle",         // Search files
            "space s i": "file_finder::Toggle",         // Search git files (fallback)
            "space s r": "file_finder::Toggle",         // Search recent files
            "space s b": "tab_switcher::Toggle",        // Search buffers
            "space s g": "pane::DeploySearch",          // Search by grep
            "space s w": "pane::DeploySearch",          // Search current word
            "space s o": "outline::Toggle",             // Symbol search

            // Panels
            "space e": "project_panel::ToggleFocus",    // File explorer
            "space o o": "agent::ToggleFocus",          // AI agent
            "space x x": "diagnostics::Deploy"          // Diagnostics (quickfix)
        }
    },

    // ============================================================================
    // LSP NAVIGATION & ACTIONS
    // ============================================================================
    {
        "context": "VimControl && !menu",
        "bindings": {
            // Navigation
            "g d": "editor::GoToDefinition",
            "g shift-d": "editor::GoToDeclaration",
            "g i": "editor::GoToImplementation",
            "g r": "editor::FindAllReferences",
            "g o": "editor::GoToTypeDefinition",
            "shift-k": "editor::Hover",

            // Actions
            "space r n": "editor::Rename",
            "space v a": "editor::ToggleCodeActions",
            "space v d": "editor::Hover",

            // Formatting
            "space f f": "editor::Format",
            "space f l": "editor::Format"
        }
    },

    // ============================================================================
    // DIAGNOSTICS
    // ============================================================================
    {
        "context": "VimControl && !menu",
        "bindings": {
            "space d j": "editor::GoToDiagnostic",
            "space d k": "editor::GoToPreviousDiagnostic"
        }
    },

    // ============================================================================
    // GIT OPERATIONS
    // ============================================================================
    {
        "context": "vim_mode == normal || vim_mode == visual || vim_mode == operator || VimControl && !menuVimControl && !menu",
        "bindings": {
            "space g g": "git_panel::ToggleFocus"       // Git status
        }
    },
    {
        "context": "VimControl && !menu",
        "bindings": {
            "space g s": "git::StageAndNext",           // Stage hunk
            "space g u": "git::UnstageAndNext",         // Unstage hunk
            "space g x": "git::Restore",                // Restore hunk
            "space g b": "git::Blame",                  // Git blame
            "space g d": "git::Diff"                    // Git diff
        }
    },

    // Git panel bindings
    {
        "context": "GitPanel && ChangesList",
        "use_key_equivalents": true,
        "bindings": {
            "s": "git::StageFile",
            "u": "git::UnstageFile",
            "x": ["git::RestoreFile", { "skip_prompt": false }],
            "p p": "git::Pull",
            "shift-p p": "git::Push",
            "b b": "git::Branch"
        }
    },

    // ============================================================================
    // AI AGENT OPERATIONS
    // ============================================================================
    {
        "context": "(VimControl && !menu) || (AgentPanel && !Editor) || (AgentPanel > MessageEditor > Editor && VimControl && vim_mode == normal)",
        "bindings": {
            "space o y": "agent::AllowOnce",
            "space o shift-y": "agent::AllowAlways",
            "space o x": "agent::RejectOnce",
            "space o shift-x": "agent::RejectAll",
            "space o k": "agent::KeepAll"
        }
    },

    // // Agent diff view bindings
    // {
    //     "context": "Editor && editor_agent_diff",
    //     "bindings": {
    //         "space o y": "agent::Keep",
    //         "space o shift-y": "agent::KeepAll",
    //         "space o x": "agent::Reject",
    //         "space o shift-x": "agent::RejectAll"
    //     }
    // },

    // ============================================================================
    // EDITOR - NORMAL MODE
    // ============================================================================
    {
        "context": "VimControl && !menu",
        "bindings": {
            // Selection
            "space a": "editor::SelectAll",

            // Focus mode - hide all panels
            "space space": "workspace::ToggleZoom"
        }
    },

    // ============================================================================
    // EDITOR - INSERT MODE
    // ============================================================================
    {
        "context": "Editor && vim_mode == insert",
        "bindings": {
            // Quick escape from insert mode (optional, commented out)
            // "j k": "vim::NormalBefore"
        }
    },

    // ============================================================================
    // EDITOR - VISUAL MODE
    // ============================================================================
    {
        "context": "Editor && vim_mode == visual",
        "bindings": {
            // Move lines
            "shift-j": "editor::MoveLineDown",
            "shift-k": "editor::MoveLineUp",

            // Indentation
            "<": "editor::Outdent",
            ">": "editor::Indent",

            // LSP actions
            "space v a": "editor::ToggleCodeActions",
            "space f f": "editor::Format"
        }
    },

    // ============================================================================
    // EDITOR - NORMAL + VISUAL MODE
    // ============================================================================
    {
        "context": "Editor && vim_mode == normal || Editor && vim_mode == visual",
        "bindings": {
            // System clipboard
            "space y": "editor::Copy",
            "space p": "editor::Paste"
        }
    },

    // ============================================================================
    // COMPLETION MENU
    // ============================================================================
    {
        "context": "Editor && showing_completions",
        "bindings": {
            "ctrl-y": "editor::ConfirmCompletion"
        }
    },

    // ============================================================================
    // TERMINAL
    // ============================================================================
    {
        "context": "vim_mode == normal || vim_mode == visual || vim_mode == operator || VimControl && !menuVimControl && !menu",
        "bindings": {
            "ctrl-z": "terminal_panel::ToggleFocus"
        }
    },
    {
        "context": "Terminal",
        "bindings": {
            "ctrl z": "terminal_panel::Toggle",
            // Deshabilitar ctrl-n y ctrl-p para permitir navegaci√≥n en fzf
            "ctrl-n": null,
            "ctrl-p": null
        }
    },

    // ============================================================================
    // PROJECT PANEL
    // ============================================================================
    {
        "context": "vim_mode == normal || vim_mode == visual || vim_mode == operator || VimControl && !menuVimControl && !menu",
        "bindings": {
            "space e": "project_panel::ToggleFocus"
        }
    },
    {
        "context": "ProjectPanel",
        "bindings": {
            "space e": "workspace::ToggleLeftDock"
        }
    }
]
